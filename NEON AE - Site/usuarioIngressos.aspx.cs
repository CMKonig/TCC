using System; using System.Collections.Generic; using System.Linq; using System.Web; using System.Web.UI; using System.Web.UI.WebControls; using System.Data; using System.Drawing; public partial class usuarioIngressos : System.Web.UI.Page { Criptografia cripto = new Criptografia("NEON"); protected void Page_Load(object sender, EventArgs e) { if (!IsPostBack) { Session["precoUsu"] = "0"; DataView dv = (DataView)sqlFPgto.Select(DataSourceSelectArguments.Empty); if (dv.Table.Rows.Count != 0) { var numCard = cripto.Decrypt(dv.Table.Rows[0]["numcartao_pgto"].ToString()); var last4 = numCard.Substring(numCard.Length-4,4); String fpgto = "<b>"+cripto.Decrypt(dv.Table.Rows[0]["cartao_pgto"].ToString())+"</b>" + " - ..." + last4.ToString(); Session["PARAfpgto"] = fpgto; lblFPgto.Text = fpgto; lblFPgto.Visible = true;lblSemFPgto.Visible = false; } else { lblSemFPgto.Visible = true; lblFPgto.Visible = false; } } } protected void ddlQtdIng_SelectedIndexChanged(object sender, EventArgs e) { lblPrecoIng.ForeColor = Color.Empty; double preco = Convert.ToDouble(Session["mediaPreco"].ToString()), conv = 5, total; if (ddlQtdIng.SelectedIndex == 0) lblPrecoIng.Text = string.Empty; Session["precoUsu"] = "0"; if(ddlQtdIng.SelectedIndex == 1) { lblPrecoIng.Text = "R$" + preco.ToString("#0.00") + " + Conveniência: R$" + conv.ToString("#0.00"); total = preco + conv; Session["precoUsu"] = total; } if (ddlQtdIng.SelectedIndex == 2) { preco = preco * 2; conv = conv * 2; lblPrecoIng.Text = "R$" + preco.ToString("#0.00") + " + Conveniência: R$" + conv.ToString("#0.00"); total = preco + conv; Session["precoUsu"] = total; } if (ddlQtdIng.SelectedIndex == 3) { preco = preco * 3; conv = conv * 3; lblPrecoIng.Text = "R$" + preco.ToString("#0.00") + " + Conveniência: R$" + conv.ToString("#0.00"); total = preco + conv; Session["precoUsu"] = total; } if (ddlQtdIng.SelectedIndex == 4) { preco = preco * 4; conv = conv * 4; lblPrecoIng.Text = "R$" + preco.ToString("#0.00") + " + Conveniência: R$" + conv.ToString("#0.00"); total = preco + conv; Session["precoUsu"] = total; } if (ddlQtdIng.SelectedIndex == 5) { preco = preco * 5; conv = conv * 5; lblPrecoIng.Text = "R$" + preco.ToString("#0.00") + " + Conveniência: R$" + conv.ToString("#0.00"); total = preco + conv; Session["precoUsu"] = total; } } protected void btnProx_Click(object sender, EventArgs e) { if (Session["precoUsu"].ToString() != "0" && lblFPgto.Visible == true) { DataView dv = (DataView)sqlFPgto.Select(DataSourceSelectArguments.Empty); Session["PARAidpgto"] = dv.Table.Rows[0]["id_pgto"].ToString(); Session["PARAprecoUsu"] = Session["precoUsu"].ToString(); Session["PARAqtdIng"] = ddlQtdIng.SelectedValue; Response.Redirect("usuarioIngressos2.aspx"); } else { if (Session["precoUsu"].ToString() == "0") { ddlQtdIng.BorderColor = Color.Red; lblPrecoIng.ForeColor = Color.Red; lblPrecoIng.Text = "PREENCHA OS CAMPOS!"; btnProx.BackColor = Color.Red; btnProx.Text = "ERRO"; } else {ddlQtdIng.BorderColor = Color.Empty;btnProx.BackColor = Color.Cyan;btnProx.Text = "Próximo";} if (lblFPgto.Visible == false) { lblPrecoIng.ForeColor = Color.Red; lblPrecoIng.Text = "VOCÊ DEVE CRIAR UMA FORMA DE PAGAMENTO PARA PROSSEGUIR!";btnProx.BackColor = Color.Red; btnProx.Text = "ERRO"; } else {btnProx.BackColor = Color.Cyan; btnProx.Text = "Próximo";} if (Session["precoUsu"].ToString() == "0" && lblFPgto.Visible == false) { ddlQtdIng.BorderColor = Color.Red; lblPrecoIng.ForeColor = Color.Red;lblPrecoIng.Text = "DADOS INVÁLIDOS!"; btnProx.BackColor = Color.Red; btnProx.Text = "ERRO"; } } } }