using System; using System.Collections.Generic; using System.Linq; using System.Web; using System.Web.UI; using System.Web.UI.WebControls; using System.Data; using System.Drawing; public partial class usuarioEventos2 : System.Web.UI.Page { Criptografia cripto = new Criptografia("NEON"); DataView dvR; protected void Page_Load(object sender, EventArgs e) { try { DataView dv = (DataView)sqlChosenOne.Select(DataSourceSelectArguments.Empty); DataView dv2 = (DataView)sqlIngressos.Select(DataSourceSelectArguments.Empty); DataView dv3 = (DataView)sqlDataFim.Select(DataSourceSelectArguments.Empty); Image1.ImageUrl = "~//img//uploaded//"+cripto.Decrypt(dv.Table.Rows[0]["img"].ToString()); lblEvento.Text = cripto.Decrypt(dv.Table.Rows[0]["nome_evento"].ToString()); Session["PARAevento"] = cripto.Decrypt(dv.Table.Rows[0]["nome_evento"].ToString()); Session["PARAideven"] = Request.QueryString["id"]; lblDetalhes.Text = cripto.Decrypt(dv.Table.Rows[0]["detalhes"].ToString()).Replace(".",".<br>"); lblTipo.Text = cripto.Decrypt(dv.Table.Rows[0]["tipo"].ToString()); lblFaet.Text = cripto.Decrypt(dv.Table.Rows[0]["faet"].ToString()); lblSubtipo.Text = cripto.Decrypt(dv.Table.Rows[0]["subtipo"].ToString()); lblEmpresa.Text = cripto.Decrypt(dv.Table.Rows[0]["empresa"].ToString()); try { if(cripto.Decrypt(dv2.Table.Rows[0]["qtddisp_ing"].ToString()) == "0") { lblQtdIngDispTot.Visible = true; lblQtdIng.Visible = true; lblQtdIng.Text = cripto.Decrypt(dv2.Table.Rows[0]["qtddisp_ing"].ToString()); Session["ingOK"] = "NAO"; } else { lblQtdIngDispTot.Visible = true; lblQtdIng.Visible = true; lblQtdIng.Text = cripto.Decrypt(dv2.Table.Rows[0]["qtddisp_ing"].ToString()); Session["ingOK"] = "OK"; } } catch { lblQtdIngDispTot.Visible = false; lblQtdIng.Visible = false; Session["ingOK"] = "NAO"; } if (cripto.Decrypt(dv.Table.Rows[0]["status"].ToString()) == "a") { lblStatus.Text = "ABERTO"; } else { lblStatus.Text = "PRIVADO"; } lblLocal.Text = cripto.Decrypt(dv.Table.Rows[0]["local"].ToString()); lblNum.Text = cripto.Decrypt(dv.Table.Rows[0]["num"].ToString()); lblUf.Text = cripto.Decrypt(dv.Table.Rows[0]["uf"].ToString()); lblCid.Text = cripto.Decrypt(dv.Table.Rows[0]["cid"].ToString()); lblRua.Text = cripto.Decrypt(dv.Table.Rows[0]["rua"].ToString()); DateTime dt = Convert.ToDateTime(dv.Table.Rows[0]["data"].ToString()); lblData.Text = dt.ToShortDateString(); Session["PARAdataI"] = dt.ToShortDateString(); DateTime hr = Convert.ToDateTime(dv.Table.Rows[0]["hora"].ToString()); lblHr.Text = hr.ToShortTimeString(); Session["PARAhoraI"] = hr.ToShortTimeString(); DateTime dt2 = Convert.ToDateTime(dv3.Table.Rows[0]["fimdt_even"].ToString()); lblDataFinal.Text = dt2.ToShortDateString(); Session["PARAdataF"] = dt2.ToShortDateString(); DateTime hr2 = Convert.ToDateTime(dv3.Table.Rows[0]["fimhr_even"].ToString()); lblHrFinal.Text = hr2.ToShortTimeString(); Session["PARAhoraF"] = hr2.ToShortTimeString(); try { if (cripto.Decrypt(dv2.Table.Rows[0]["qtddisp_ing"].ToString()) == "0") { lblPrecoIng.Visible = false; lblMediaPIng.Visible = false; } else { lblPrecoIng.Visible = true; lblMediaPIng.Visible = true; double preco = Convert.ToDouble(cripto.Decrypt(dv2.Table.Rows[0]["precotot_ing"].ToString())); double mQtdIng = Convert.ToDouble(lblQtdIng.Text); double mediaPreco = preco / mQtdIng; Session["mediaPreco"] = mediaPreco; lblPrecoIng.Text = "R$" + mediaPreco.ToString("#0.00"); } } catch{lblPrecoIng.Visible = false; lblMediaPIng.Visible = false;} } catch { Response.Redirect("usuarioEventos.aspx"); } } protected void imgbtnLike_Click(object sender, ImageClickEventArgs e) { dvR = (DataView)sqlRanking.Select(DataSourceSelectArguments.Empty); int qtdfav = Convert.ToInt32(cripto.Decrypt(dvR.Table.Rows[0]["qtdfav_rank"].ToString())); Contador.click++; if (Contador.click % 2 == 0) { sHFaud_usu(); imgbtnLike.ImageUrl = "~//img//HIGHFIVE.jpg"; btnIngressos.Visible = false; qtdfav--; if (qtdfav <= 1000){sqlRanking.UpdateParameters["classif"].DefaultValue = cripto.Encrypt("BRONZE");} else if (qtdfav > 1000 && qtdfav <= 5000){sqlRanking.UpdateParameters["classif"].DefaultValue = cripto.Encrypt("PRATA");} else{sqlRanking.UpdateParameters["classif"].DefaultValue = cripto.Encrypt("OURO");} sqlRanking.UpdateParameters["qtd"].DefaultValue = cripto.Encrypt(qtdfav.ToString()); } else { HFaud_usu(); imgbtnLike.ImageUrl = "~//img//HIGHFIVE4.jpg"; if (Session["ingOK"].ToString() == "OK"){btnIngressos.Visible = true;} else { btnIngressos.Visible = false; } qtdfav++; if (qtdfav <= 1000) { sqlRanking.UpdateParameters["classif"].DefaultValue = cripto.Encrypt("BRONZE"); } else if (qtdfav > 1000 && qtdfav <= 5000) { sqlRanking.UpdateParameters["classif"].DefaultValue = cripto.Encrypt("PRATA"); } else { sqlRanking.UpdateParameters["classif"].DefaultValue = cripto.Encrypt("OURO"); } sqlRanking.UpdateParameters["qtd"].DefaultValue = cripto.Encrypt(qtdfav.ToString()); } sqlRanking.Update(); sqlChosenOne.Insert(); } protected void btnIngressos_Click(object sender, EventArgs e) { Response.Redirect("usuarioIngressos.aspx"); } private void HFaud_usu() { sqlChosenOne.InsertParameters["id"].DefaultValue = Session["getIdUsu"].ToString(); sqlChosenOne.InsertParameters["table"].DefaultValue = "ranking"; sqlChosenOne.InsertParameters["desc"].DefaultValue = "Deu HIGH FIVE em um Evento"; string hr = DateTime.Now.Hour.ToString() + ":" + DateTime.Now.Minute.ToString("0#"); sqlChosenOne.InsertParameters["hr"].DefaultValue = hr; string data = DateTime.Now.Date.ToShortDateString(); sqlChosenOne.InsertParameters["data"].DefaultValue = data; } private void sHFaud_usu() { sqlChosenOne.InsertParameters["id"].DefaultValue = Session["getIdUsu"].ToString(); sqlChosenOne.InsertParameters["table"].DefaultValue = "ranking"; sqlChosenOne.InsertParameters["desc"].DefaultValue = "Tirou HIGH FIVE de um Evento"; string hr = DateTime.Now.Hour.ToString() + ":" + DateTime.Now.Minute.ToString("0#"); sqlChosenOne.InsertParameters["hr"].DefaultValue = hr; string data = DateTime.Now.Date.ToShortDateString(); sqlChosenOne.InsertParameters["data"].DefaultValue = data; } }