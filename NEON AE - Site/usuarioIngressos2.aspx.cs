using System; using System.Collections.Generic; using System.Linq; using System.Web; using System.Web.UI; using System.Web.UI.WebControls; using System.Drawing; using System.Data; public partial class usuarioIngressos2 : System.Web.UI.Page { Criptografia cripto = new Criptografia("NEON"); protected void Page_Load(object sender, EventArgs e) { try { lblEvento.Text = Session["PARAevento"].ToString(); lblDataI.Text = Session["PARAdataI"].ToString(); lblHoraI.Text = Session["PARAhoraI"].ToString(); lblDataF.Text = Session["PARAdataF"].ToString(); lblHoraF.Text = Session["PARAhoraF"].ToString(); lblQtdIng.Text = Session["PARAqtdIng"].ToString(); double total = Convert.ToDouble(Session["PARAprecoUsu"]); lblPreco.Text = "R$"+total.ToString("#0.00");lblFPgto.Text = Session["PARAfpgto"].ToString(); } catch { Response.Redirect("usuarioEventos.aspx"); } } protected void btnFinCompra_Click(object sender, EventArgs e) { if (txtSenha.Text == string.Empty){txtSenha.BorderColor = Color.Red;lblErro.Text = "DIGITE SUA SENHA!";} else if(txtSenha.Text != Session["PARAsenha"].ToString()){txtSenha.BorderColor = Color.Red;lblErro.Text = "SENHA INCORRETA!";} else { aud_usu(); sqlCompra.InsertParameters["qtd"].DefaultValue = cripto.Encrypt(Session["PARAqtdIng"].ToString()); sqlCompra.InsertParameters["preco"].DefaultValue = cripto.Encrypt(Session["PARAprecoUsu"].ToString()); String dthr = DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"); sqlCompra.InsertParameters["dthr"].DefaultValue = dthr; sqlCompra.Insert(); sqlAudUsu.Insert(); double total = Convert.ToDouble(Session["PARAprecoUsu"]); DataView dv = (DataView)sqlAudUsu.Select(DataSourceSelectArguments.Empty); Email.compraIngresso(cripto.Decrypt(Session["emailusu"].ToString()), cripto.Decrypt(dv.Table.Rows[0]["nome_usu"].ToString()), Session["PARAqtdIng"].ToString(), Session["PARAevento"].ToString(), total.ToString("#0.00")); Response.Redirect("usuarioEventos.aspx"); } } private void aud_usu() { sqlAudUsu.InsertParameters["id"].DefaultValue = Session["getIdUsu"].ToString(); sqlAudUsu.InsertParameters["table"].DefaultValue = "compra"; sqlAudUsu.InsertParameters["desc"].DefaultValue = "Comprou ingressos"; string hr = DateTime.Now.Hour.ToString() + ":" + DateTime.Now.Minute.ToString("0#"); sqlAudUsu.InsertParameters["hr"].DefaultValue = hr; string data = DateTime.Now.Date.ToShortDateString(); sqlAudUsu.InsertParameters["data"].DefaultValue = data; } }