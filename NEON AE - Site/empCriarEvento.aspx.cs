using System;using System.Collections.Generic;using System.Linq;using System.Web;using System.Web.UI;using System.Web.UI.WebControls;using System.IO;using System.Data;using System.Drawing; public partial class empCriarEvento : System.Web.UI.Page { Criptografia cripto = new Criptografia("NEON"); protected void Page_Load(object sender, EventArgs e){} public void aud_emp() { sqlIdEventoPrivado.InsertParameters["id"].DefaultValue = Session["idEmp"].ToString(); sqlIdEventoPrivado.InsertParameters["table"].DefaultValue = "evento"; sqlIdEventoPrivado.InsertParameters["desc"].DefaultValue = "Criando um evento"; string hr = DateTime.Now.Hour.ToString() + ":" + DateTime.Now.Minute.ToString(); sqlIdEventoPrivado.InsertParameters["hr"].DefaultValue = hr; string data = DateTime.Now.Date.ToShortDateString(); sqlIdEventoPrivado.InsertParameters["data"].DefaultValue = data; } protected void btnCriarEvento_Click(object sender, EventArgs e) { try { if (txtNomeEven.Text == string.Empty || txtCidade.Text == string.Empty || txtDetalhe.Text == string.Empty || txtDtFim.Text == string.Empty || txtDtInicio.Text == string.Empty || txtHrFim.Text == string.Empty || txtHrInicio.Text == string.Empty || txtNomeLocal.Text == string.Empty || txtNumLocal.Text == string.Empty || txtRua.Text == string.Empty || txtUf.Text == string.Empty || ddlStatus.SelectedIndex == 0 || ddlSubtipoEvento.SelectedIndex == 0 || ddlTipoEvento.SelectedIndex == 0 || txtNomeEven.Text == string.Empty && txtCidade.Text == string.Empty && txtDetalhe.Text == string.Empty && txtDtFim.Text == string.Empty && txtDtInicio.Text == string.Empty && txtHrFim.Text == string.Empty && txtHrInicio.Text == string.Empty && txtNomeLocal.Text == string.Empty && txtNumLocal.Text == string.Empty && txtRua.Text == string.Empty && txtUf.Text == string.Empty && ddlStatus.SelectedIndex == 0 && ddlSubtipoEvento.SelectedIndex == 0 && ddlTipoEvento.SelectedIndex == 0) { dirty(); if (txtNomeEven.Text == string.Empty) { txtNomeEven.BorderColor = Color.Red; lblResp.Text = "PREENCHA OS CAMPOS!"; } else txtNomeEven.BorderColor = Color.Empty; if (txtCidade.Text == string.Empty) { txtCidade.BorderColor = Color.Red; lblResp.Text = "PREENCHA OS CAMPOS!"; } else txtCidade.BorderColor = Color.Empty; if (txtDetalhe.Text == string.Empty) { txtDetalhe.BorderColor = Color.Red; lblResp.Text = "PREENCHA OS CAMPOS!"; } else txtDetalhe.BorderColor = Color.Empty; if (txtDtFim.Text == string.Empty) { txtDtFim.BorderColor = Color.Red; lblResp.Text = "PREENCHA OS CAMPOS!"; } else txtDtFim.BorderColor = Color.Empty; if (txtDtInicio.Text == string.Empty) { txtDtInicio.BorderColor = Color.Red; lblResp.Text = "PREENCHA OS CAMPOS!"; } else txtDtInicio.BorderColor = Color.Empty; if (txtHrFim.Text == string.Empty) { txtHrFim.BorderColor = Color.Red; lblResp.Text = "PREENCHA OS CAMPOS!"; } else txtHrFim.BorderColor = Color.Empty; if (txtHrInicio.Text == string.Empty) { txtHrInicio.BorderColor = Color.Red; lblResp.Text = "PREENCHA OS CAMPOS!"; } else txtHrInicio.BorderColor = Color.Empty; if (txtNomeLocal.Text == string.Empty) { txtNomeLocal.BorderColor = Color.Red; lblResp.Text = "PREENCHA OS CAMPOS!"; } else txtNomeLocal.BorderColor = Color.Empty; if (txtNumLocal.Text == string.Empty) { txtNumLocal.BorderColor = Color.Red; lblResp.Text = "PREENCHA OS CAMPOS!"; } else txtNumLocal.BorderColor = Color.Empty; if (txtRua.Text == string.Empty) { txtRua.BorderColor = Color.Red; lblResp.Text = "PREENCHA OS CAMPOS!"; } else txtRua.BorderColor = Color.Empty; if (txtUf.Text == string.Empty) { txtUf.BorderColor = Color.Red; lblResp.Text = "PREENCHA OS CAMPOS!"; } else txtUf.BorderColor = Color.Empty; if (ddlStatus.SelectedIndex == 0) { ddlStatus.BorderColor = Color.Red; lblResp.Text = "PREENCHA OS CAMPOS!"; } else ddlStatus.BorderColor = Color.Empty; if (ddlSubtipoEvento.SelectedIndex == 0) { ddlSubtipoEvento.BorderColor = Color.Red; lblResp.Text = "PREENCHA OS CAMPOS!"; } else ddlSubtipoEvento.BorderColor = Color.Empty; if (ddlTipoEvento.SelectedIndex == 0) { ddlTipoEvento.BorderColor = Color.Red; lblResp.Text = "PREENCHA OS CAMPOS!"; } else ddlTipoEvento.BorderColor = Color.Empty; } else{ String nomeArq, urlBD; nomeArq = Path.GetFileName(FileUpload1.FileName); if (nomeArq != "") { FileUpload1.SaveAs(Server.MapPath("\\img\\uploaded\\" + nomeArq)); urlBD = nomeArq; } else urlBD = "semimagem.jpg"; sqlCriarEvento.InsertParameters["img"].DefaultValue = cripto.Encrypt(urlBD); DataView dv = (DataView)sqlCriarEvento.Select(DataSourceSelectArguments.Empty); int qtdEven = Convert.ToInt32(dv.Table.Rows[0]["qtdEven"].ToString()); if (qtdEven != 0) { txtDtInicio.BorderColor = Color.Empty; txtHrInicio.BorderColor = Color.Empty; txtDtFim.BorderColor = Color.Empty; txtHrFim.BorderColor = Color.Empty; txtNomeEven.BorderColor = Color.Red; lblResp.Text = "NOME JÁ UTILIZADO."; } else { try { DateTime dtI = Convert.ToDateTime(txtDtInicio.Text); String dtICorreta = dtI.ToString("yyyy/MM/dd"); DateTime hrI = Convert.ToDateTime(txtHrInicio.Text); DateTime dtF = Convert.ToDateTime(txtDtFim.Text); String dtFCorreta = dtF.ToString("yyyy/MM/dd"); DateTime hrF = Convert.ToDateTime(txtHrFim.Text); if (dtF < dtI || dtF == dtI && hrF <= hrI|| (int)dtI.Year < DateTime.Now.Year|| (int)dtI.Day < DateTime.Now.Day && (int)dtI.Month <= DateTime.Now.Month && (int)dtI.Year <= DateTime.Now.Year|| (int)dtI.Day == DateTime.Now.Day && (int)dtI.Year == DateTime.Now.Year && (int)dtI.Month<DateTime.Now.Month) { lblResp.Text = "INSIRA DATA E/OU HORA CORRETOS!"; txtDtInicio.Text = string.Empty;txtDtInicio.BorderColor = Color.Red; txtDtFim.Text = string.Empty;txtDtFim.BorderColor = Color.Red; txtHrFim.Text = string.Empty;txtHrFim.BorderColor = Color.Red; txtHrInicio.Text = string.Empty;txtHrInicio.BorderColor = Color.Red; } else { sqlCriarEvento.InsertParameters["startdt"].DefaultValue = dtICorreta;sqlCriarEvento.InsertParameters["fimdt"].DefaultValue = dtFCorreta;sqlCriarEvento.InsertParameters["starthr"].DefaultValue = txtHrInicio.Text;sqlCriarEvento.InsertParameters["fimhr"].DefaultValue = txtHrFim.Text;sqlCriarEvento.InsertParameters["evento"].DefaultValue = cripto.Encrypt(txtNomeEven.Text);sqlCriarEvento.InsertParameters["uf"].DefaultValue = cripto.Encrypt(txtUf.Text);sqlCriarEvento.InsertParameters["rua"].DefaultValue = cripto.Encrypt(txtRua.Text);sqlCriarEvento.InsertParameters["num"].DefaultValue = cripto.Encrypt(txtNumLocal.Text);sqlCriarEvento.InsertParameters["cid"].DefaultValue = cripto.Encrypt(txtCidade.Text);sqlCriarEvento.InsertParameters["local"].DefaultValue = cripto.Encrypt(txtNomeLocal.Text);sqlCriarEvento.InsertParameters["detalhes"].DefaultValue = cripto.Encrypt(txtDetalhe.Text); aud_emp(); DataView dvEvento = (DataView)sqlIdEventoPrivado.Select(DataSourceSelectArguments.Empty); if (ddlStatus.SelectedIndex == 1) { sqlCriarEvento.Insert(); int id_even = Convert.ToInt32(dvEvento.Table.Rows[0]["qtd_even"].ToString()) + 1; sqlRanking.InsertParameters["id"].DefaultValue = id_even.ToString(); sqlRanking.InsertParameters["classif"].DefaultValue = cripto.Encrypt("BRONZE"); sqlRanking.InsertParameters["qtdfav"].DefaultValue = cripto.Encrypt("0"); sqlRanking.Insert(); sqlIdEventoPrivado.Insert(); Response.Redirect("empEventos.aspx"); } if (ddlStatus.SelectedIndex == 2) { Session["startdt"] = dtICorreta;Session["fimdt"] = dtFCorreta;Session["starthr"] = txtHrInicio.Text;Session["fimhr"] = txtHrFim.Text;Session["evento"] = cripto.Encrypt(txtNomeEven.Text);Session["uf"] = cripto.Encrypt(txtUf.Text);Session["rua"] = cripto.Encrypt(txtRua.Text);Session["num"] = cripto.Encrypt(txtNumLocal.Text);Session["cid"] = cripto.Encrypt(txtCidade.Text);Session["local"] = cripto.Encrypt(txtNomeLocal.Text);Session["detalhes"] = cripto.Encrypt(txtDetalhe.Text);Session["tipo"] = ddlTipoEvento.SelectedIndex;Session["subtipo"]= ddlSubtipoEvento.SelectedIndex;Session["status"]= ddlStatus.SelectedIndex;Session["img"] = cripto.Encrypt(urlBD); Session["getIdEvento"] = Convert.ToInt32(dvEvento.Table.Rows[0]["qtd_even"].ToString()) + 1; Response.Redirect("empIngresso.aspx"); } } } catch { txtNomeEven.BorderColor = Color.Empty; txtDtInicio.BorderColor = Color.Red; txtHrInicio.BorderColor = Color.Red; txtDtFim.BorderColor = Color.Red; txtHrFim.BorderColor = Color.Red; lblResp.Text = "INSIRA DATA E/OU HORA CORRETA(S)!"; } } } } catch (System.Data.SqlClient.SqlException) {Email.erro("empCriarEvento.aspx"); lblResp.Text = "ERRO! TENTE NOVAMENTE MAIS TARDE"; } } private void dirty(){txtNomeEven.BorderColor = Color.Red; txtCidade.BorderColor = Color.Red; txtDetalhe.BorderColor = Color.Red; txtDtFim.BorderColor = Color.Red; txtDtInicio.BorderColor = Color.Red; txtHrFim.BorderColor = Color.Red; txtHrInicio.BorderColor = Color.Red; txtNomeLocal.BorderColor = Color.Red; txtNumLocal.BorderColor = Color.Red; txtRua.BorderColor = Color.Red; txtUf.BorderColor = Color.Red; ddlStatus.BorderColor = Color.Red; ddlSubtipoEvento.BorderColor = Color.Red; ddlTipoEvento.BorderColor = Color.Red; lblResp.Text = "PREENCHA OS CAMPOS!";} }