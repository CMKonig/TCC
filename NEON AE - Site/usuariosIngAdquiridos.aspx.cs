using System;using System.Collections.Generic;using System.Linq;using System.Web;using System.Web.UI;using System.Web.UI.WebControls;using System.Data;using System.Drawing; public partial class usuariosIngAdquiridos : System.Web.UI.Page { Criptografia cripto = new Criptografia("NEON"); protected void Page_Load(object sender, EventArgs e) { try { if (!IsPostBack) { listarTudo(); } } catch { Response.Redirect("Login.aspx"); Email.erro("usuariosIngAdquiridos.aspx"); } } public void listarTudo() { DataView listaCripto= (DataView)sqlCompra.Select(DataSourceSelectArguments.Empty); DataTable nTab = new DataTable(); nTab.Columns.Add("id",typeof(int)); nTab.Columns.Add("evento",typeof(string)); nTab.Columns.Add("qtding",typeof(int)); nTab.Columns.Add("total",typeof(double)); nTab.Columns.Add("dthr",typeof(DateTime)); nTab.Columns.Add("dtstart",typeof(DateTime)); nTab.Columns.Add("dtfim", typeof(DateTime)); for (int i = 0; i < listaCripto.Table.Rows.Count; i++) { DataRow line = nTab.NewRow(); line["id"] = listaCripto.Table.Rows[i]["id"].ToString(); line["evento"] = cripto.Decrypt(listaCripto.Table.Rows[i]["evento"].ToString()); line["qtding"] = cripto.Decrypt(listaCripto.Table.Rows[i]["qtding"].ToString()); line["total"] = cripto.Decrypt(listaCripto.Table.Rows[i]["total"].ToString()); line["dthr"] = listaCripto.Table.Rows[i]["dthr"].ToString(); line["dtstart"] = listaCripto.Table.Rows[i]["dtstart"].ToString(); line["dtfim"] = listaCripto.Table.Rows[i]["fimdt"].ToString(); nTab.Rows.Add(line); } gvEventos.DataSource = nTab; gvEventos.DataBind(); } protected void btnCancel_Click(object sender, ImageClickEventArgs e) { try{ aud_usu(); sqlCompra.Insert(); sqlCompra.Update(); listarTudo(); Response.Redirect("usuarioEventos.aspx");} catch { if (Session["getIdUsu"].ToString() == string.Empty) { Email.erro("usuariosIngAdquiridos.aspx"); lblErro.Visible = true;} } } private void aud_usu() { sqlCompra.InsertParameters["id"].DefaultValue = Session["getIdUsu"].ToString(); sqlCompra.InsertParameters["table"].DefaultValue = "compra"; sqlCompra.InsertParameters["desc"].DefaultValue = "Limpou a lista de ingressos adquiridos"; string hr = DateTime.Now.Hour.ToString() + ":" + DateTime.Now.Minute.ToString("0#"); sqlCompra.InsertParameters["hr"].DefaultValue = hr; string data = DateTime.Now.Date.ToShortDateString(); sqlCompra.InsertParameters["data"].DefaultValue = data; } }