using System; using System.Collections.Generic; using System.Linq; using System.Web; using System.Web.UI; using System.Web.UI.WebControls; using System.Drawing; using System.Data; using System.IO; public partial class empEventos : System.Web.UI.Page { Criptografia cripto = new Criptografia("NEON"); protected void Page_Load(object sender, EventArgs e){loading();} protected void btnCriarEvento_Click(object sender, EventArgs e){Response.Redirect("empCriarEvento.aspx");} protected void btnAltEvento_Click(object sender, ImageClickEventArgs e) { foreach (GridViewRow linha in gvEventos.Rows) { CheckBox op = (CheckBox)linha.FindControl("chkEventos"); if (op.Checked == true) { lblResp.BorderColor = Color.Empty; lblResp.Text = string.Empty; Label coisas = (Label)linha.FindControl("Label1"); Session["altEvento"] = Convert.ToInt32(coisas.Text); Response.Redirect("empVisEvento.aspx"); } else { lblResp.BorderColor = Color.Red; lblResp.Text = "SELECIONE ALGO PARA VISUALIZAR."; } } } protected void btnDelEvento_Click(object sender, ImageClickEventArgs e) { try { foreach (GridViewRow linha in gvEventos.Rows) { CheckBox op = (CheckBox)linha.FindControl("chkEventos"); if (op.Checked == true) { lblResp.ForeColor = Color.Empty; lblResp.Text = string.Empty; Label coisas = (Label)linha.FindControl("Label1"); sqlEventos.UpdateParameters["id"].DefaultValue = coisas.Text; sqlEventos.Update(); aud_emp(); sqlAudEmp.Insert(); } if (op.Checked == false) { lblResp.ForeColor = Color.Red; lblResp.Text = "SELECIONE ALGUM EVENTO PARA DESATIVAR!"; } } loading(); } catch { Email.erro("empEventos.aspx"); lblResp.ForeColor = Color.Red; lblResp.Text = "ERRO! TENTE NOVAMENTE MAIS TARDE."; } } public void loading() { DataView dv = (DataView)sqlEventos.Select(DataSourceSelectArguments.Empty); if (dv.Table.Rows.Count == 0) { lblResp.ForeColor = Color.DarkCyan; lblResp.Text = "VOCÊ NÃO CRIOU NENHUM EVENTO AINDA! CLIQUE EM CRIAR EVENTO PARA CRIAR UM."; } else { lblResp.ForeColor = Color.Empty; lblResp.Text = string.Empty; listarTudo(); } } public void listarTudo() { DataView dv = (DataView)sqlEventos.Select(DataSourceSelectArguments.Empty); DataTable nTab = new DataTable(); nTab.Columns.Add("id", typeof(int)); nTab.Columns.Add("nome_evento", typeof(string)); nTab.Columns.Add("tipo", typeof(string)); nTab.Columns.Add("faet", typeof(string)); nTab.Columns.Add("local", typeof(string)); nTab.Columns.Add("data", typeof(DateTime)); nTab.Columns.Add("hora", typeof(DateTime)); for (int i = 0; i < dv.Table.Rows.Count; i++) { DataRow line = nTab.NewRow(); line["id"] = dv.Table.Rows[i]["id"].ToString(); line["nome_evento"] = cripto.Decrypt(dv.Table.Rows[i]["nome_evento"].ToString()); line["tipo"] = cripto.Decrypt(dv.Table.Rows[i]["tipo"].ToString()); line["faet"] = cripto.Decrypt(dv.Table.Rows[i]["faet"].ToString()); line["local"] = cripto.Decrypt(dv.Table.Rows[i]["local"].ToString()); line["data"] = dv.Table.Rows[i]["data"].ToString(); line["hora"] = dv.Table.Rows[i]["hora"].ToString(); nTab.Rows.Add(line); } gvEventos.DataSource = nTab; gvEventos.DataBind(); } public void aud_emp() { sqlAudEmp.InsertParameters["id"].DefaultValue = Session["idEmp"].ToString(); sqlAudEmp.InsertParameters["table"].DefaultValue = "evento"; sqlAudEmp.InsertParameters["desc"].DefaultValue = "Desativou um evento"; string hr = DateTime.Now.Hour.ToString() + ":" + DateTime.Now.Minute.ToString(); sqlAudEmp.InsertParameters["hr"].DefaultValue = hr; string data = DateTime.Now.Date.ToShortDateString(); sqlAudEmp.InsertParameters["data"].DefaultValue = data; } }