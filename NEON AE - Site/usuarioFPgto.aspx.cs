using System;using System.Collections.Generic;using System.Linq;using System.Web;using System.Web.UI;using System.Web.UI.WebControls;using System.Data;using System.Drawing; public partial class usuarioFPgto : System.Web.UI.Page { Criptografia cripto = new Criptografia("NEON"); protected void Page_Load(object sender, EventArgs e) { } protected void rblFPgto_SelectedIndexChanged(object sender, EventArgs e) { ddlTipoCard.Visible = true; ddlAnoExp.Visible = true; ddlMesExp.Visible = true; lblNumCard.Visible = true; lblDataExp.Visible = true; lblMesExp.Visible = true; lblAnoExp.Visible = true; lblTitular.Visible = true; lblCVV.Visible = true; lblHelpCVV.Visible = true; txtCVV.Visible = true; txtNumCard.Visible = true; txtTitular.Visible = true; btnFPgto.BackColor = Color.Cyan; btnFPgto.Text = "ADICIONAR FORMA DE PAGAMENTO"; btnFPgto.Visible = true; } protected void btnFPgto_Click(object sender, EventArgs e) { if(txtNumCard.Text != string.Empty && ddlMesExp.SelectedIndex != 0 && ddlAnoExp.SelectedIndex != 0 && txtTitular.Text != string.Empty && txtCVV.Text != string.Empty) { DataView dv = (DataView)sqlFPgto.Select(DataSourceSelectArguments.Empty); if (dv.Table.Rows.Count != 0) { sqlFPgto.UpdateParameters["cartao"].DefaultValue = cripto.Encrypt(ddlTipoCard.SelectedValue); sqlFPgto.UpdateParameters["num"].DefaultValue = cripto.Encrypt(txtNumCard.Text); String dtExp = ddlMesExp.SelectedValue + "/" + ddlAnoExp.SelectedValue; sqlFPgto.UpdateParameters["data"].DefaultValue = cripto.Encrypt(dtExp); sqlFPgto.UpdateParameters["titular"].DefaultValue = cripto.Encrypt(txtTitular.Text); sqlFPgto.UpdateParameters["cvv"].DefaultValue = cripto.Encrypt(txtCVV.Text); sqlFPgto.Update(); } else { sqlFPgto.InsertParameters["cartao"].DefaultValue = cripto.Encrypt(ddlTipoCard.SelectedValue); sqlFPgto.InsertParameters["num"].DefaultValue = cripto.Encrypt(txtNumCard.Text); String dtExp = ddlMesExp.SelectedValue +"/"+ ddlAnoExp.SelectedValue; sqlFPgto.InsertParameters["data"].DefaultValue = cripto.Encrypt(dtExp); sqlFPgto.InsertParameters["titular"].DefaultValue = cripto.Encrypt(txtTitular.Text); sqlFPgto.InsertParameters["cvv"].DefaultValue = cripto.Encrypt(txtCVV.Text); sqlFPgto.Insert(); } aud_usu(); sqlAudUsu.Insert(); Response.Redirect("usuarioPerfil.aspx"); } else { if (txtNumCard.Text == string.Empty) { txtNumCard.BorderColor = Color.Red; btnFPgto.BackColor = Color.Red; btnFPgto.Text = "PREENCHA OS CAMPOS!"; } else { txtNumCard.BorderColor = Color.Empty; } if (ddlMesExp.SelectedIndex == 0) { ddlMesExp.BorderColor = Color.Red; btnFPgto.BackColor = Color.Red; btnFPgto.Text = "PREENCHA OS CAMPOS!"; } else { ddlMesExp.BorderColor = Color.Empty; } if (ddlAnoExp.SelectedIndex == 0) { ddlAnoExp.BorderColor = Color.Red; btnFPgto.BackColor = Color.Red; btnFPgto.Text = "PREENCHA OS CAMPOS!"; } else { ddlAnoExp.BorderColor = Color.Empty; } if (txtTitular.Text == string.Empty) { txtTitular.BorderColor = Color.Red; btnFPgto.BackColor = Color.Red; btnFPgto.Text = "PREENCHA OS CAMPOS!"; } else { txtTitular.BorderColor = Color.Empty; } if (txtCVV.Text == string.Empty) { txtCVV.BorderColor = Color.Red; btnFPgto.BackColor = Color.Red; btnFPgto.Text = "PREENCHA OS CAMPOS!"; } else { txtCVV.BorderColor = Color.Empty; } } } private void aud_usu() { sqlAudUsu.InsertParameters["id"].DefaultValue = Session["getIdUsu"].ToString(); sqlAudUsu.InsertParameters["table"].DefaultValue = "fpgto"; sqlAudUsu.InsertParameters["desc"].DefaultValue = "Adicionou uma Forma de Pagamento"; string hr = DateTime.Now.Hour.ToString() + ":" + DateTime.Now.Minute.ToString("0#"); sqlAudUsu.InsertParameters["hr"].DefaultValue = hr; string data = DateTime.Now.Date.ToShortDateString(); sqlAudUsu.InsertParameters["data"].DefaultValue = data; } }